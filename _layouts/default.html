{% assign project = page.url | remove_first: '/' | split: '/' | first %}
{% assign project_url = project | prepend: '/' | append: '/' %}
{% assign project_name = 'ZotPlus' %}
{% assign conditional_project_name = 'ZotPlus' %}
{% assign sorted_pages = site.pages | sort: 'weight', 'last' %}

{% for p in sorted_pages %}
  {% if p.url contains project_url and p.url contains '/index.html' %}
    {% unless page.url contains project_url and page.url contains '/index.html' %}
      {% assign conditional_project_name = p.title %}
    {% endunless %}
    {% assign project_name = p.title %}
  {% endif %}
{% endfor %}

<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>{{ page.title }} - {{ conditional_project_name }}</title>
    <link rel="stylesheet" href="/stylesheets/styles.css">
    <link rel="stylesheet" href="/stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/javascripts/main.js"></script>
    <script src="/javascripts/jsencrypt.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <header>
        <h1>{{ conditional_project_name }} - {{ page.title }}</h1>
        <p></p>
      </header>

      <div id="banner">
        <span id="logo"></span>

        {% unless project contains '.' %}
          <a href="https://github.com/ZotPlus/zotero-{{ project }}" class="button fork"><strong>View On GitHub</strong></a>
          <div class="downloads">
            <span>Downloads:</span>
            <ul>
              <li><a href="https://github.com/ZotPlus/zotero-{{ project }}/zipball/master" class="button">ZIP</a></li>
              <li><a href="https://github.com/ZotPlus/zotero-{{ project }}/tarball/master" class="button">TAR</a></li>
              {% assign xpi = project | append: '-version.html' %}
              <li><a href="https://github.com/ZotPlus/zotero-{{ project }}/releases/download/{% include {{xpi}} %}/zotero-{{ project }}-{% include {{xpi}} %}.xpi" class="button">XPI</a></li>
            </ul>
          </div>
        {% endunless %}
      </div><!-- end banner -->

    <div class="wrapper">
      <nav>

        <h1>ZotPlus</h1>
        <ul class="root">
          {% for p in sorted_pages %}
            {% assign path = p.url | remove_first: '/' | split: '/' %}
            {% if path.size == 1 %}
              <li><a {% if p.url == page.url %}class="active"{% endif %} href="{{ p.url }}">{{ p.title }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>

        <h1>Projects</h1>
        <ul class="projects">
          {% for p in sorted_pages %}
            {% assign path = p.url | remove_first: '/' | split: '/' %}
            {% if path.size > 1 and path.last == 'index.html' %}
              <li><a {% if p.url == page.url %}class="active"{% endif %} href="{{ p.url }}">{{ p.title }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>

        <h2>{{ project_name }}</h2>
        <ul class="pages">
          {% for p in sorted_pages %}
            {% if p.url contains project_url %}
              <li><a {% if p.url == page.url %}class="active"{% endif %} href="{{ p.url }}">{{ p.title }}</a></li>
            {% endif %}
          {% endfor %}
        </ul>

        <h3>{{ page.title }}</h2>
        <ul class="current-page"></ul>
      </nav>
      <section>
        <h3>{{ page.title }}</h3>

        {{ content }}
      </section>
      <footer>
        <p>Project maintained by <a href="https://github.com/ZotPlus">ZotPlus</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
